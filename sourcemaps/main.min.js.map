{"version":3,"sources":["js/script.js","01_main.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChGA","file":"../components/main.min.js","sourcesContent":["const container = document.querySelector('.wrap');\r\nconst spiner = document.querySelector('.item');\r\nconst getButton = document.querySelector('.getButton');\r\nconst title = document.querySelector('h3');\r\n\r\nVK.init({\r\n    apiId: 8077206,\r\n    status: true\r\n});\r\n\r\nconst addPost = function (text, date) {\r\n    const newPost = document.createElement('p');\r\n    const postDate = document.createElement('span');\r\n    \r\n    postDate.textContent = new Date(date * 1000).toLocaleString(\"ru\", {dateStyle: \"medium\", timeStyle: \"short\"});\r\n    newPost.innerHTML = text;\r\n    \r\n    newPost.prepend(postDate);\r\n    container.append(newPost);\r\n}\r\n\r\nconst formatingText = function (text) {\r\n    const regex = /\\n/gi;\r\n    return text.replace(regex, '<br>')\r\n}\r\n\r\n\r\nconst getPosts = function(plusPosts = 0) {\r\n    VK.Api.call('wall.get', {owner_id: -19853844, v:\"5.81\", count: 5, offset: [plusPosts]}, function(r) {\r\n        title.textContent = \"Последние записи сообщества Дневник.ру\"\r\n        \r\n        if (r.response) {\r\n            r.response.items.map(function(item) { \r\n                if (item.text != \"\") {\r\n                    const formatText = formatingText(item.text);\r\n                    addPost(formatText, item.date);\r\n                }   \r\n            });\r\n        \r\n            spiner.style.display = 'none';\r\n            getButton.style.display = 'block';\r\n        } else { \r\n            spiner.style.display = 'none';\r\n            container.textContent = 'Извините, сервер недоступен';\r\n        }    \r\n    });  \r\n}\r\n\r\n\r\nconst getStatus = function() {\r\n    VK.Auth.getLoginStatus(function(e) {\r\n        if (e.status === 'unknown') {\r\n            title.textContent = \"Авторизируйтесь, чтобы получить последние записи сообщества Дневник.ру\"\r\n            VK.UI.button('button');\r\n            spiner.style.display = 'none';\r\n            const buttonVK = document.querySelector('#button');\r\n            buttonVK.addEventListener('click', function() {\r\n                VK.Auth.login(function(data) {\r\n                    if (data.status === \"connected\") {\r\n                        spiner.style.display = \"block\";\r\n                        buttonVK.style.display = \"none\";\r\n                        getPosts();\r\n                    } else if (data.status === \"unknown\") {\r\n                        title.textContent = \"Неудачная авторизация, попробуйте ещё раз\";\r\n                    } else if (data.status === \"not_authorized\") {\r\n                        title.textContent = \"Разрешите доступ к приложению\";\r\n                    } \r\n                })\r\n            })\r\n        } else {\r\n            spiner.style.display = \"block\";\r\n            getPosts();\r\n        };\r\n    });\r\n}\r\n\r\n\r\n\r\n\r\ngetStatus();\r\n\r\ngetButton.addEventListener('click', function(e) {\r\n    const count = container.querySelectorAll('p').length;\r\n    spiner.style.display = \"block\";\r\n    getPosts(count);\r\n});\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n",""]}